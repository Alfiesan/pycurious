<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.6.3.dev1+g3e64fe2" />
<title>pycurious.download API documentation</title>
<meta name="description" content="This module provides some simple functions to download or install files â€¦" />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{font-weight:bold}#index h4 + ul{margin-bottom:.6em}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase;cursor:pointer}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async>
</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>pycurious.download</code></h1>
</header>
<section id="section-intro">
<p>This module provides some simple functions to download or install files.</p>
<p>It is good practise to store a checksum for each file. A checksum is a
unique signature used to identify a file, and ensure that the data
contained within the file is legitimate. Here is a sample workflow for
downloading EMAG2 (v3) and evaluating its checksum:</p>
<pre><code class="python">resource = {
     &quot;local_file&quot;:&quot;../../data/EMAG2_V3_20170530.npz&quot;,
     &quot;md5&quot;:'c0898b6a91efb3f13783873a8b67380c',
     &quot;url&quot;:&quot;https://zenodo.org/record/3245551/files/EMAG2_V3_20170530.npz?download=1&quot;,
     &quot;expected_size&quot;:&quot;500Mb&quot;
    }

download_cached_file(resource[&quot;url&quot;], resource[&quot;local_file&quot;], resource[&quot;md5&quot;], resource[&quot;expected_size&quot;])
</code></pre>
<p>The file will commence downloading if it does not already exist in the local directory
or if the checksum (md5) does not match. If you do not know the checksum for a file, run</p>
<pre><code class="python">md5sum(filename)
</code></pre>
<p>to return its unique identifier.</p>
<details class="source">
<summary>Source code</summary>
<pre><code class="python"># Copyright 2018-2019 Ben Mather, Robert Delhaye
# 
# This file is part of PyCurious.
# 
# PyCurious is free software: you can redistribute it and/or modify
# it under the terms of the GNU Lesser General Public License as published by
# the Free Software Foundation, either version 3 of the License, or any later version.
# 
# PyCurious is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Lesser General Public License for more details.
# 
# You should have received a copy of the GNU Lesser General Public License
# along with PyCurious.  If not, see &lt;http://www.gnu.org/licenses/&gt;.

&#34;&#34;&#34;
This module provides some simple functions to download or install files.

It is good practise to store a checksum for each file. A checksum is a
unique signature used to identify a file, and ensure that the data
contained within the file is legitimate. Here is a sample workflow for
downloading EMAG2 (v3) and evaluating its checksum:

```python
resource = {
     &#34;local_file&#34;:&#34;../../data/EMAG2_V3_20170530.npz&#34;,
     &#34;md5&#34;:&#39;c0898b6a91efb3f13783873a8b67380c&#39;,
     &#34;url&#34;:&#34;https://zenodo.org/record/3245551/files/EMAG2_V3_20170530.npz?download=1&#34;,
     &#34;expected_size&#34;:&#34;500Mb&#34;
    }

download_cached_file(resource[&#34;url&#34;], resource[&#34;local_file&#34;], resource[&#34;md5&#34;], resource[&#34;expected_size&#34;])
```

The file will commence downloading if it does not already exist in the local directory
or if the checksum (md5) does not match. If you do not know the checksum for a file, run

```python
md5sum(filename)
```

to return its unique identifier.
&#34;&#34;&#34;

def download_file(url, local_filename, expected_size=&#34;Unknown&#34;):
    &#34;&#34;&#34;
    Download files from a URL to a local filename.

    Args:
        url : str
            URL that points to the file to be downloaded
        local_filename : str
            download content to this filename
    &#34;&#34;&#34;
    import requests
    import os
    import time
    import shutil

    # We might want to bundle some files if they are small / compressed or not readily available for download

    if (os.path.isfile(url)):
        shutil.copy(url, local_filename)
    
    else:
        r = requests.get(url, stream=True)

        start_time = time.time()
        last_time = start_time
        datasize = 0

        with open(local_filename, &#39;wb&#39;) as f:
            for chunk in r.iter_content(chunk_size=10000000): 
                if chunk: # filter out keep-alive new chunks
                    f.write(chunk)
                    f.flush()
                    datasize += len(chunk)
                    if (time.time() - last_time) &gt; 2.5:
                        print (&#34;{:.1f} Mb in {:.1f}s / {}&#34;.format(datasize / 1.0e6, time.time() - start_time, expected_size))
                        last_time = time.time()

    return 


def md5sum(filename):
    &#34;&#34;&#34;
    Returns the checksum for a given file
    &#34;&#34;&#34;
    import hashlib
    from functools import partial

    with open(filename, mode=&#39;rb&#39;) as f:
        d = hashlib.md5()
        for buf in iter(partial(f.read, 4096), b&#39;&#39;):
            d.update(buf)
    return d.hexdigest()


def download_cached_file(location_url, local_file, expected_md5, expected_size=&#34;Unknown&#34;):
    &#34;&#34;&#34;
    Download files from a URL to a local filename.

    Same as `download_file()` but checks whether the file has already
    been downloaded from its checksum.

    Args:
        location_url : str
            URL that points to the file to be downloaded
        local_file : str
            download content to this filename
        expected_md5 : str
            checksum belonging to that file
        expected_size : float / int / str (optional)
            optional size of file (default=&#34;Unknown&#34;)
    &#34;&#34;&#34;
    import sys

    try:
        assert md5sum(local_file) == expected_md5
        print (&#34;Using cached file - {}&#34;.format(local_file))
        return(2)
    
    except (IOError, AssertionError) as error_info:
        # No file or the wrong file ... best go download it
        # print &#34;Assertion failed - {}&#34;.format(sys.exc_info())
        
        try:
            data_file = download_file(location_url, local_file, expected_size)
            print (&#34;Downloaded from {}&#34;.format( location_url ))
            return(1)

        except:
            print (&#34;Unable to download {} [{}] &#34;.format( location_url, sys.exc_info() ))
            return(0)


def report_cached_file(local_file, expected_md5):
    &#34;&#34;&#34;
    Report whether the local file matches its checksum

    Args:
        local_file : str
            string pointing to the local file
        expected_md5 : str
            checksum assigned to `local_file`.
    &#34;&#34;&#34;
    import os
    import os.path
    
    if not os.path.isfile(local_file):
        print (&#34;Local file {} does not exist&#34;.format(local_file))
    else:
        if len(expected_md5) == 0 or md5sum(local_file) == expected_md5:
            print (&#34;Cached file {} is valid&#34;.format(local_file))
        else:
            print (&#34;Cached file {} failed, checksum {}&#34;.format(local_file, md5sum(local_file)))</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="pycurious.download.download_cached_file"><code class="name flex">
<span>def <span class="ident">download_cached_file</span></span>(<span>location_url, local_file, expected_md5, expected_size='Unknown')</span>
</code></dt>
<dd>
<section class="desc"><p>Download files from a URL to a local filename.</p>
<p>Same as <a title="pycurious.download.download_file" href="#pycurious.download.download_file"><code>download_file()</code></a> but checks whether the file has already
been downloaded from its checksum.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>location_url</code></strong> :&ensp;<code>str</code></dt>
<dd>URL that points to the file to be downloaded</dd>
<dt><strong><code>local_file</code></strong> :&ensp;<code>str</code></dt>
<dd>download content to this filename</dd>
<dt><strong><code>expected_md5</code></strong> :&ensp;<code>str</code></dt>
<dd>checksum belonging to that file</dd>
<dt><strong><code>expected_size</code></strong> :&ensp;<code>float</code> / <code>int</code> / <code>str</code> (optional)</dt>
<dd>optional size of file (default="Unknown")</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def download_cached_file(location_url, local_file, expected_md5, expected_size=&#34;Unknown&#34;):
    &#34;&#34;&#34;
    Download files from a URL to a local filename.

    Same as `download_file()` but checks whether the file has already
    been downloaded from its checksum.

    Args:
        location_url : str
            URL that points to the file to be downloaded
        local_file : str
            download content to this filename
        expected_md5 : str
            checksum belonging to that file
        expected_size : float / int / str (optional)
            optional size of file (default=&#34;Unknown&#34;)
    &#34;&#34;&#34;
    import sys

    try:
        assert md5sum(local_file) == expected_md5
        print (&#34;Using cached file - {}&#34;.format(local_file))
        return(2)
    
    except (IOError, AssertionError) as error_info:
        # No file or the wrong file ... best go download it
        # print &#34;Assertion failed - {}&#34;.format(sys.exc_info())
        
        try:
            data_file = download_file(location_url, local_file, expected_size)
            print (&#34;Downloaded from {}&#34;.format( location_url ))
            return(1)

        except:
            print (&#34;Unable to download {} [{}] &#34;.format( location_url, sys.exc_info() ))
            return(0)</code></pre>
</details>
</dd>
<dt id="pycurious.download.download_file"><code class="name flex">
<span>def <span class="ident">download_file</span></span>(<span>url, local_filename, expected_size='Unknown')</span>
</code></dt>
<dd>
<section class="desc"><p>Download files from a URL to a local filename.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>url</code></strong> :&ensp;<code>str</code></dt>
<dd>URL that points to the file to be downloaded</dd>
<dt><strong><code>local_filename</code></strong> :&ensp;<code>str</code></dt>
<dd>download content to this filename</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def download_file(url, local_filename, expected_size=&#34;Unknown&#34;):
    &#34;&#34;&#34;
    Download files from a URL to a local filename.

    Args:
        url : str
            URL that points to the file to be downloaded
        local_filename : str
            download content to this filename
    &#34;&#34;&#34;
    import requests
    import os
    import time
    import shutil

    # We might want to bundle some files if they are small / compressed or not readily available for download

    if (os.path.isfile(url)):
        shutil.copy(url, local_filename)
    
    else:
        r = requests.get(url, stream=True)

        start_time = time.time()
        last_time = start_time
        datasize = 0

        with open(local_filename, &#39;wb&#39;) as f:
            for chunk in r.iter_content(chunk_size=10000000): 
                if chunk: # filter out keep-alive new chunks
                    f.write(chunk)
                    f.flush()
                    datasize += len(chunk)
                    if (time.time() - last_time) &gt; 2.5:
                        print (&#34;{:.1f} Mb in {:.1f}s / {}&#34;.format(datasize / 1.0e6, time.time() - start_time, expected_size))
                        last_time = time.time()

    return </code></pre>
</details>
</dd>
<dt id="pycurious.download.md5sum"><code class="name flex">
<span>def <span class="ident">md5sum</span></span>(<span>filename)</span>
</code></dt>
<dd>
<section class="desc"><p>Returns the checksum for a given file</p></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def md5sum(filename):
    &#34;&#34;&#34;
    Returns the checksum for a given file
    &#34;&#34;&#34;
    import hashlib
    from functools import partial

    with open(filename, mode=&#39;rb&#39;) as f:
        d = hashlib.md5()
        for buf in iter(partial(f.read, 4096), b&#39;&#39;):
            d.update(buf)
    return d.hexdigest()</code></pre>
</details>
</dd>
<dt id="pycurious.download.report_cached_file"><code class="name flex">
<span>def <span class="ident">report_cached_file</span></span>(<span>local_file, expected_md5)</span>
</code></dt>
<dd>
<section class="desc"><p>Report whether the local file matches its checksum</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>local_file</code></strong> :&ensp;<code>str</code></dt>
<dd>string pointing to the local file</dd>
<dt><strong><code>expected_md5</code></strong> :&ensp;<code>str</code></dt>
<dd>checksum assigned to <code>local_file</code>.</dd>
</dl></section>
<details class="source">
<summary>Source code</summary>
<pre><code class="python">def report_cached_file(local_file, expected_md5):
    &#34;&#34;&#34;
    Report whether the local file matches its checksum

    Args:
        local_file : str
            string pointing to the local file
        expected_md5 : str
            checksum assigned to `local_file`.
    &#34;&#34;&#34;
    import os
    import os.path
    
    if not os.path.isfile(local_file):
        print (&#34;Local file {} does not exist&#34;.format(local_file))
    else:
        if len(expected_md5) == 0 or md5sum(local_file) == expected_md5:
            print (&#34;Cached file {} is valid&#34;.format(local_file))
        else:
            print (&#34;Cached file {} failed, checksum {}&#34;.format(local_file, md5sum(local_file)))</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="pycurious" href="index.html">pycurious</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="pycurious.download.download_cached_file" href="#pycurious.download.download_cached_file">download_cached_file</a></code></li>
<li><code><a title="pycurious.download.download_file" href="#pycurious.download.download_file">download_file</a></code></li>
<li><code><a title="pycurious.download.md5sum" href="#pycurious.download.md5sum">md5sum</a></code></li>
<li><code><a title="pycurious.download.report_cached_file" href="#pycurious.download.report_cached_file">report_cached_file</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.6.3.dev1+g3e64fe2</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>